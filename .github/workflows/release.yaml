name: Release

on:
  push:
    branches:
      - main
    paths:
      - "**/*.tf"
      - "**/K8S_VERSION"
  workflow_dispatch:

jobs:
  release:
    uses: DND-IT/github-workflows/.github/workflows/gh-release-on-main.yaml@v3
    with:
      metadata_file: ./K8S_VERSION
      update_version_aliases: false

  notify-slack:
    name: Notify Slack of Release
    needs: [release]
    if: success()
    uses: DND-IT/github-workflows/.github/workflows/notify-slack.yaml@v3
    secrets:
      slack_bot_token: ${{ secrets.SLACK_BOT_TOKEN }}
    with:
      channel: "C09LG2L8EQ5" # #it_pts_dai_releases
      notification_title: "New Terraform AWS Kubernetes Platform Release ðŸš€"
      notification_message: "A new release has been published!"
      status: "success"
      additional_fields: |
        [
          {"name": "Repository", "value": "<${{ github.server_url }}/${{ github.repository }}|${{ github.repository }}>"}
        ]
      include_workflow_link: true
      include_triggered_by: true
